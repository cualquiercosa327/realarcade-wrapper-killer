<?xml version="1.0" encoding="UTF-8"?>
<ArcadeInstaller Tps="gamehouse_" Lang="en"
                 Src="" StoreFront="GameHouse"
                 GameId="amg-zumadeluxe" Country="US"
                 GameName="Zuma Deluxe"
                 DefaultGamesRoot="C:\GameHouse Games"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                 xsi:noNamespaceSchemaLocation="..\..\..\..\..\..\..\..\GamesPlatform\RealArcadeInstaller\schema\ArcadeInstaller.xsd">
    
    <OpenCandyOptions Key="8d30c2d11c2b21cea7900fc2251f51b2" Secret="759dc1db79cb03bf36bfe2614209bbc1" AdvancedOptions="IncompatibleSwTest0001"/>
  
    <URLParameters lsrc="" rsrc="" cpath=""
                   affiliate="67616d65686f7573655f000000000000"
                   contentid="fe6efc7f4b49871cc68485d6e12c2336" otp="" tracking="31383136000000000000000000000000"
                   currency="555344000000" price="" timestamp="" />
  
    <Uninstall Text="Zuma Deluxe" AddRemove="true" IncGame="true" Assoc="false" />
    <SetEnv Key="tps" Val="gamehouse_" />
    <SetEnv Key="channel" Val="gamehouse_"/>
    <SetEnv Key="storefront" Val="GameHouse"/>
    <SetEnv Key="GameId" Val="amg-zumadeluxe" />
    <SetGlobalEnv Key="CMScontentid" Val="fe6efc7f4b49871cc68485d6e12c2336" />
    <SetEnv Key="thumbnail" Val="http://i.realone.com/assets/rn/img/4/5/9/6/10886954-6195567-thumbnail.jpg" />
    <SetEnv Key="genre" Val="Match 3 Games" />
    <ConditionDef Id="GetChromePath" Type="LuaBlock" Var="g_env.ChromePath = g_env.sysDrive .. ':\\' .. g_env.programFolder .. '\\Google\\Chrome\\Application' return false" />
    <SetGlobalEnv Key="ChromePath" Val="default" >
        <ConditionCheck Id="GetChromePath" Val="true" />
    </SetGlobalEnv>

    <SetGlobalEnv Key="chromebrandcode" Val="RNPM" />
    <ConditionDef Id="installKidStarter2" Type="LuaBlock" Var="return false" />
    <ConditionDef Id="installKidStarter3" Type="LuaBlock" Var="return false" />
    <ConditionDef Id="installKidStarter4" Type="LuaBlock" Var="return false" />
    <SetGlobalEnv Key="kidstarterbrandcode" Val="GameHouse" />
    <SetGlobalEnv Key="kidstarterbrandcode" Val="GameHouse2" >
        <ConditionCheck Id="installKidStarter2" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="kidstarterbrandcode" Val="GameHouse3" >
        <ConditionCheck Id="installKidStarter3" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="kidstarterbrandcode" Val="GameHouse4" >
        <ConditionCheck Id="installKidStarter4" Val="true" />
    </SetGlobalEnv>
    <ConditionDef Id="IsKidStarterInstalled" Type="RegKeyExists" Var="HKEY_LOCAL_MACHINE\software\Brilliant Software\KidStarter" />
    <ConditionDef Id="IsKidStarterOS" Type="LuaBlock" Var="
        local errHandler = ErrorHandler()
        local win32 = Win32Interop()
        local osversion = win32.OSVersion()
        if osversion &lt; 5 then return false end
        if osversion == 5 then
            local osfull = win32.GetRegKeyValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion', 'CurrentVersion')
            local osmajor, osminor
            if osfull ~= nil then
                _,_, osmajor, osminor = string.find(osfull, &quot;(%d.)(%d)&quot;)
                if osmajor == nil or osminor == nil then 
                    io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;XP versioning cannnot be found in CurrentVersion &quot; .. osfull)
                    return false
                end
                if tonumber(osminor) &lt; 1 then
                    io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;XP minor version is less than one in CurrentVersion &quot; .. osfull)
                    return false
                end
            else
                io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Could not find XP OS CurrentVersion &quot;)
                return false
            end
            local csdversion = win32.GetRegKeyValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion', 'CSDVersion')
            if csdversion ~= nil then
                if string.find( csdversion, &quot;1&quot; ) then
                    io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;XP SP is less than 2 with CSDVersion &quot; .. csdversion)
                    return false
                end
            else
                io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Could not find XP OS Service Pack CSDVersion &quot;)
                return false
            end
        end
        local processor_size = GetEnvironmentString(&quot;ProgramFiles(x86)&quot;)
        if processor_size ~= nil and processor_size ~= &quot;&quot; then
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),processor_size, &quot; is the 32 bit path on this 64bit OS.&quot;)
            return false
        else
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Environment variable ProgramFiles(x86) not found.&quot;)
        end
        return true
    "/>
    <ConditionDef Id="DetectDotNetv4" Type="LuaBlock" Var="
        local errHandler = ErrorHandler()
        local win32 = Win32Interop()
        local installnum = win32.GetRegKeyDWORDValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4\\Client', 'Install')
        if installnum ~= nil and installnum == 1 then
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Detected .NET Framework Version v4 Client is installed &quot; .. tostring(installnum))
            return true
        end
        installnum = nil
        installnum = win32.GetRegKeyDWORDValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4\\Full', 'Install')
        if installnum ~= nil and installnum == 1 then
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Detected .NET Framework Version v4 Full is installed &quot; .. tostring(installnum))
            return true
        end
        installnum = nil
        installnum = win32.GetRegKeyDWORDValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.0\\Client', 'Install')
        if installnum ~= nil and installnum == 1 then
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Detected .NET Framework Version v4 Client is installed &quot; .. tostring(installnum))
            return true
        end
        installnum = nil
        installnum = win32.GetRegKeyDWORDValue('HKEY_LOCAL_MACHINE', 'SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.0\\Full', 'Install')
        if installnum ~= nil and installnum == 1 then
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;Detected .NET Framework Version v4 Full in installed &quot; .. tostring(installnum))
            return true
        end
        return false
    "/>
    <ConditionDef Id="IsKidStarterCountry" Type="LuaBlock" Var="
        return true
    "/>
    <ConditionDef Id="CheckSequencedDLPOrder" Type="LuaBlock" Var="
        if CheckCondition('OfferedGoogle', 'true') then return false end
        if CheckCondition('OfferedChrome', 'true') then return false end
        local errHandler      = ErrorHandler()
        local win32           = Win32Interop()
        local dlptype = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferType')
        if dlptype ~= nil and dlptype ~= &quot;&quot; then return dlptype end
        return 'ks'
    "/>
    <ConditionDef Id="CheckSequencedDLPOrderAndCount" Type="LuaBlock" Var="
        if g_env.sequenceddlporder == nil then g_env.sequenceddlporder = 'true' return true end
        if CheckCondition('OfferedGoogle', 'true') then return false end
        if CheckCondition('OfferedChrome', 'true') then return false end
        local errHandler      = ErrorHandler()
        local win32           = Win32Interop()
        local nCount = 1
        local dlptype = 'ks' -- KidStarter
        local offered = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferCount')
        if offered ~= nil and offered ~= &quot;&quot; then nCount = tonumber(offered) + 1 end
        if nCount &gt;= 4 then
            nCount = 1
            dlptype = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferType')
            if dlptype ~= nil then
              if dlptype == 'ks' then dlptype = 'oc'
              elseif dlptype == 'oc' then dlptype = 'ks'
              else dlptype = 'oc' end
            else
              dlptype = 'oc'
            end
            win32.CreateRegKey('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferType', dlptype, keyvaltype)
        end
        win32.CreateRegKey('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferCount', nCount, keyvaltype)
        if dlptype == 'oc' and nCount == 1 then return false end
        return true
    "/>
    <ConditionDef Id="ShouldOfferKidStarter" Type="LuaBlock" Var="
        local errHandler      = ErrorHandler()
        local win32           = Win32Interop()
        local nCount = 1
        local offered = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferCount')
        if offered ~= nil and offered ~= &quot;&quot; then nCount = tonumber(offered) end
        if nCount == 1 then return true end
        return false
    "/>
    <ConditionDef Id="WasOfferedKidStarter" Type="Environment" Var="OfferedKidStarter" />
    <ConditionDef Id="KidStarterOfferPing" Type="LuaBlock" Var="
        if g_env.offeredkidstarterping ~= nil then
            return true
        else
            local errHandler      = ErrorHandler()
            local win32           = Win32Interop()
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local tablePingPairs  = CreatePingPairsTable(&quot;ksinstapp&quot;, &quot;displayedoffer&quot;, &quot;ks&quot;, &quot;en&quot;, affiliatetag)
            local brandcode = {&quot;brandcode&quot;, &quot;GameHouse&quot;}
            table.insert(tablePingPairs,brandcode)
            g_env.offeredkidstarterping = 'true'
            errHandler.LogPing(tablePingPairs, true)
            return true
        end
    "/>
    <ConditionDef Id="GamesRootWriteable" Type="Environment" Var="GamesRootWriteable"/>
    <ConditionDef Id="ShouldOfferCandy" Type="LuaBlock" Var="
        local errHandler      = ErrorHandler()
        local win32           = Win32Interop()
        local nCount = 1
        local offered = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'GameHouse\\2.0\\Preferences', 'DLPOfferCount')
        if offered ~= nil and offered ~= &quot;&quot; then nCount = tonumber(offered) end
        if nCount == 1 then
            local mainDlg = luacom.CreateObject('InstallerDlg.InstallDlgCtl') 
            mainDlg:InitializeCandy() 
            if mainDlg:HasCandyOffer() then
                return true
            else
                mainDlg:InstallOffer()
                return false
            end
        else
            return false
        end
    "/>
    <ConditionDef Id="IsOfferedCandy" Type="Environment" Var="OfferedCandy" />
    <ConditionDef Id="InstallCandyOffer" Type="LuaBlock" Var="
        if CheckCondition('IsOfferedCandy', 'true') then
            local mainDlg = luacom.CreateObject('InstallerDlg.InstallDlgCtl') 
            local offerselection = mainDlg:CandyChosen()
            local installerstarted = mainDlg:InstallOffer()
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;The OpenCandy installing state is &quot;, tostring(installerstarted))
            if offerselection == true and installerstarted == true then
                local errHandler      = ErrorHandler()
                local win32           = Win32Interop()
                local affiliatetag = main_env.affiliate
                if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
                local tablePingPairs  = CreatePingPairsTable(&quot;ocinstapp&quot;, &quot;installerstarted&quot;, &quot;oc&quot;, &quot;en&quot;, affiliatetag)
                errHandler.LogPing(tablePingPairs, true)
            end
        end
        return true 
    "/>
    <ConditionDef Id="OpenCandyOfferPing" Type="LuaBlock" Var="
        if g_env.offeredopencandyping ~= nil then
            return true
        else
            local errHandler      = ErrorHandler()
            local win32           = Win32Interop()
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local tablePingPairs  = CreatePingPairsTable(&quot;ocinstapp&quot;, &quot;displayedoffer&quot;, &quot;oc&quot;, &quot;en&quot;, affiliatetag)
            g_env.offeredopencandyping = 'true'
            errHandler.LogPing(tablePingPairs, true)
            return true
        end
    "/>
    <ConditionDef Id="OpenCandyAcceptedPing" Type="LuaBlock" Var="
        if CheckCondition('IsOfferedCandy', 'true') then
            local mainDlg = luacom.CreateObject('InstallerDlg.InstallDlgCtl')
            local offerselection = mainDlg:CandyChosen()
            io.write(&quot;\n&quot;, os.date(&quot;%c &quot;),&quot;The OpenCandy offer selection is &quot;, tostring(offerselection))
            if offerselection == true then
                local errHandler      = ErrorHandler()
                local win32           = Win32Interop()
                local affiliatetag = main_env.affiliate
                if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
                local tablePingPairs  = CreatePingPairsTable(&quot;ocinstapp&quot;, &quot;acceptedoffer&quot;, &quot;oc&quot;, &quot;en&quot;, affiliatetag)
                errHandler.LogPing(tablePingPairs, true)
            end
        end
        return true
    "/>
    <ConditionDef Id="CheckForInstallerDll" Type="FileExists" Var="[installerDir]/CheckInst.dll" />
    <ConditionDef Id="CheckForGamesRoot" Type="RegKeyVal" Var="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\GamesRoot" />
    <ConditionDef Id="CheckForStoreFront" Type="LuaBlock" Var="
        if CheckCondition('CheckForGamesRoot', 'nil') then return false end
        if CheckCondition('CheckForInstallerDll', 'false') then return false end
        return true
    "/>
    <ConditionDef Id="CheckForResources" Type="FileExists" Var="[installerDir]/GameHouse/resource/gh.ico" />
    <ConditionDef Id="CheckIfEULASlide" Type="LuaBlock" Var="if g_env.EULAPresented ~= nil and g_env.EULAPresented == 'true' then return true else return false end" />
    <ConditionDef Id="CanInitGameShortcuts" Type="RegKeyVal" Var ="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\GameDesktopShortcuts"/>
    <ConditionDef Id="CheckForClean" Type="RegKeyVal" Var ="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\Tps"/>
    <ConditionDef Id="OfferedGoogle" Type="Environment"  Var="OfferedGoogle"/>
    <ConditionDef Id="ShouldOfferGoogle" Type="LuaBlock" Var="
        dofile('extensions\\CheckInstallGoogleToolbar.clf')
        if CheckInstallGoogleToolbar() == true then -- true means not installed and can install
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="ReadytoCheckGoogleOffer" Type="LuaBlock" Var="
        if g_env.readytocheckgoogleoffer ~= nil and g_env.readytocheckgoogleoffer ~= 4 then
            g_env.readytocheckgoogleoffer = g_env.readytocheckgoogleoffer + 1
            return false
        else
            if g_env.readytocheckgoogleoffer == nil then
                g_env.readytocheckgoogleoffer = 1
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="OfferedChrome" Type="Environment"  Var="OfferedChrome"/>
    <ConditionDef Id="ChromeNumtries" Type="RegKeyVal" Var="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\ChromeNumtries"/>
    <ConditionDef Id="GoogleTBOfferPing" Type="LuaBlock" Var="
        local errHandler = ErrorHandler()
        local win32 = Win32Interop()
        if g_env.offeredgoogleping ~= nil then
            return true
        else
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local tablePingPairs  = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;displayedoffer&quot;, &quot;gtb&quot;, &quot;en&quot;, affiliatetag)
            local brandcode = {&quot;brandcode&quot;, &quot;RNRM&quot;}
            table.insert(tablePingPairs,brandcode)
            g_env.offeredgoogleping = 'true'
            errHandler.LogPing(tablePingPairs, true)
            return true
        end
    "/>
    <ConditionDef Id="GoogleTBStatusPing" Type="LuaBlock" Var="
        if g_env.statusgoogleping == nil then
            g_env.statusgoogleping = 'true'
            return true
        else
            if g_env.statusgoogleping ~= 'done' then
                local errHandler = ErrorHandler()
                local win32 = Win32Interop()
                local affiliatetag = main_env.affiliate
                if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
                local tablePingPairs  = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;statusoffer&quot;, &quot;gtb&quot;, &quot;en&quot;, affiliatetag)
                local status = g_checkGoogleToolbarState
                if status == -1 then status = 100000 end
                local statuscode = {&quot;statuscode&quot;, tostring(status)}
                table.insert(tablePingPairs,statuscode)
                errHandler.LogPing(tablePingPairs, true)
                g_env.statusgoogleping = 'done'
            end
            return true
         end
     "/>
     <ConditionDef Id="ChromeOfferPing" Type="LuaBlock" Var="
        if g_env.offeredchromeping ~= nil then
            return true
        else
            local errHandler      = ErrorHandler()
            local win32           = Win32Interop()
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local nCount          = 1
            local offered         = win32.GetRegKeyValue('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'RealArcade\\2.0\\Preferences', 'GoogleChromeOffered')
            local tablePingPairs  = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;displayedoffer&quot;, &quot;gc&quot;, &quot;en&quot;, affiliatetag)
            local brandcode = {&quot;brandcode&quot;, g_env.chromebrandcode}
            table.insert(tablePingPairs,brandcode)
            if offered ~= nil and offered ~= &quot;&quot; then nCount = tonumber(offered) + 1 end
            win32.CreateRegKey('HKEY_CLASSES_ROOT', g_constants[&quot;basekey&quot;] .. 'RealArcade\\2.0\\Preferences', 'GoogleChromeOffered', nCount, keyvaltype)
            g_env.offeredchromeping = 'true'
            errHandler.LogPing(tablePingPairs, true)
            return true
        end
    "/>
    <ConditionDef Id="ChromeStatusPing" Type="LuaBlock" Var="
         if g_env.statuschromeping == nil then
             g_env.statuschromeping = 'true'
             return true
         else
             if g_env.statuschromeping ~= 'done' then
                 local errHandler      = ErrorHandler()
                 local win32           = Win32Interop()
                 local affiliatetag = main_env.affiliate
                 if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
                 local tablePingPairs  = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;statusoffer&quot;, &quot;gc&quot;, &quot;en&quot;, affiliatetag)
                 local status = g_checkChromeState
                 if status == -1 then status = 100000 end
                 local statuscode = {&quot;statuscode&quot;, tostring(status)}
                 table.insert(tablePingPairs,statuscode)
                 errHandler.LogPing(tablePingPairs, true)
                 g_env.statuschromeping = 'done'
             end
             return true
         end
    "/>
    <ConditionDef Id="ShouldOfferChrome" Type="LuaBlock" Var="
        dofile('extensions\\CheckInstallChrome.clf')
        if GoogleChromeCompatibilityCheck() == true then
            return true
        else 
            return false
        end
    "/>
    <ConditionDef Id="CheckIsInstallingChrome" Type="Environment" Var="IsInstallingChrome" />
    <ConditionDef Id="CheckSpecialChromeLaunch" Type="Environment" Var="SpecialChromeLaunch" />
    <ConditionDef Id="IsSpecialGameForGoogleChrome" Type="LuaBlock" Var="return false"/>
    <ConditionDef Id="ExecuteGoogleChrome" Type="LuaBlock" Var="
        if CheckCondition('CheckIsInstallingChrome', 'true') and
            CheckCondition('CheckSpecialChromeLaunch', 'ready') then
            local errHandler     = ErrorHandler()
            local win32          = Win32Interop()                  
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local tablePingPairs = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;launchedoffer&quot;, &quot;gc&quot;, &quot;en&quot;, affiliatetag)
            local brandcode = {&quot;brandcode&quot;, g_env.chromebrandcode}
            table.insert(tablePingPairs,brandcode)
            local shortLaunchCommand = g_env.sysDrive .. ':\\' .. g_env.programFolder .. '\\Google\\Chrome\\Application\\chrome.exe'
            local shortLaunchCommandBase = g_env.sysDrive .. ':\\' .. g_env.programFolder .. '\\Google\\Chrome\\Application'
            local procMgr        = luacom.CreateObject(&quot;StubbyUtil.ProcessMgr&quot;)
            procMgr:Exec( shortLaunchCommand, &quot; &quot; ,false, false, shortLaunchCommandBase , &quot;createProc&quot; )
            errHandler.LogPing(tablePingPairs, true)
         end
         return true
    "/>
    <ConditionDef Id="ExecuteGoogleChromeWithLanding" Type="LuaBlock" Var="
        if CheckCondition('CheckIsInstallingChrome', 'true') then                  
            local errHandler = ErrorHandler()
            local win32 = Win32Interop()
            local launchCommand = win32.GetRegKeyValue( 'HKEY_CLASSES_ROOT', 'Applications\\chrome.exe\\shell\\open\\command' )
            local j = 1
            local shortLaunchCommand = ''
            local shortLaunchCommnadBase = ''
		        _, j = string.find( launchCommand, '.exe' )
        		if j and j ~= 0 then 
                shortLaunchCommand = string.sub( launchCommand, 2, j )
                shortLaunchCommandBase = string.sub( launchCommand, 2, j - 11 )
            else
                shortLaunchCommand = 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'
                shortLaunchCommandBase = 'C:\\Program Files\\Google\\Chrome\\Application'
            end
            local landingPage    = 'www.gamehouse.com/?src=ghgclaunch'
            local procMgr        = luacom.CreateObject(&quot;StubbyUtil.ProcessMgr&quot;)
            local affiliatetag = main_env.affiliate
            if affiliatetag == &quot;&quot; then affiliatetag = &quot;67616d65686f7573655f000000000000&quot; end
            local tablePingPairs = CreatePingPairsTable(&quot;googleinstapp&quot;, &quot;launchedoffer&quot;, &quot;gc&quot;, &quot;en&quot;, affiliatetag)
            procMgr:Exec( shortLaunchCommand, &quot;http:&quot; .. &quot;//&quot; .. landingPage, false, false, shortLaunchCommandBase , &quot;createProc&quot; )
            errHandler.LogPing(tablePingPairs, true)
        end
        return true
    "/>
    <ConditionDef Id="CheckInstallComplete" Type="LuaBlock" Var="return g_env.InstallComplete" />
    <ConditionDef Id="CheckWrapperInterlock" Type="LuaBlock" Var="return g_env.wrapperLaunched" />
    <ConditionDef Id="CheckLaunchComplete" Type="Environment" Var="launchComplete" />
    <ConditionDef Id="CheckLaunchofWrapper" Type="LuaBlock" Var="
        if CheckCondition('CheckWrapperInterlock', 'nil') and g_env.InstallComplete == 'inprogress' then
            g_env.InstallComplete = 'true'
            local j = 1
            local errHandler = ErrorHandler()
            local win32 = Win32Interop()
            local procMgr = luacom.CreateObject(&quot;StubbyUtil.ProcessMgr&quot;)
            local launchCommand = ''
            local workDir = ''
            if CheckCondition('ExistingSpecialGamesRoot', 'false') then
                launchCommand = g_env.myGamesRoot .. &quot;\\Zuma Deluxe\\&quot; .. g_env.myGameExe
                workDir = g_env.myGamesRoot .. &quot;\\Zuma Deluxe&quot;
            else
                launchCommand = g_env.myInstallDrive .. '\\' .. g_env.programFolder .. '\\' .. g_env.specialgamesroot .. '\\' .. g_env.myGameExe
                workDir = g_env.myInstallDrive .. '\\' .. g_env.programFolder .. '\\' .. g_env.specialgamesroot
            end            
            procMgr:Exec( launchCommand, &quot;&quot;, false, false, workDir , &quot;createProc&quot; )
            g_env.wrapperLaunched = 'true'
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckSaveStatus" Type="RegKeyVal" Var="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\save" />
    <ConditionDef Id="GamesShortcutsState" Type="RegKeyVal"  Var="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences\GameDesktopShortcuts"/>
    <ConditionDef Id="CheckValidcontentid" Type="LuaBlock" Var="
            if g_env.ContentID == nil then
                return false
            else
                return true
            end
    "/>
    <ConditionDef Id="CheckValidAffiliateRGI" Type="LuaBlock" Var="
        local parm = '67616d65686f7573655f000000000000'
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            if main_env.affiliate ~= nil and main_env.affiliate ~= &quot;&quot; then
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="CheckValidAffiliate" Type="LuaBlock" Var="
        if main_env.affiliate ~= nil and main_env.affiliate == &quot;&quot; then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidTrackingRGI" Type="LuaBlock" Var="
        local parm = '31383136000000000000000000000000'
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            if main_env.tracking ~= nil and main_env.tracking ~= &quot;&quot; then
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="CheckValidTracking" Type="LuaBlock" Var="
        if main_env.tracking ~= nil and main_env.tracking == &quot;&quot; then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidCurrencyRGI" Type="LuaBlock" Var="
        local parm = '555344000000'
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            if main_env.currency ~= nil and main_env.currency ~= &quot;&quot; then
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="CheckValidCurrencyRGILegacy" Type="LuaBlock" Var="
        if g_env.currency ~= nil and g_env.currency == 'USD' then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidCurrency" Type="LuaBlock" Var="
        if main_env.currency ~= nil and main_env.currency == &quot;&quot; then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidPriceRGI" Type="LuaBlock" Var="
        local parm = ''
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            if main_env.price ~= nil and main_env.price ~= &quot;&quot; then
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="CheckValidPrice" Type="LuaBlock" Var="
        if main_env.price ~= nil and main_env.price == &quot;&quot; then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidTimestampRGI" Type="LuaBlock" Var="
        local parm = ''
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            if main_env.timestamp ~= nil and main_env.timestamp ~= &quot;&quot; then
                return false
            else
                return true
            end
        end
    "/>
    <ConditionDef Id="CheckValidTimestamp" Type="LuaBlock" Var="
        if main_env.timestamp ~= nil and main_env.timestamp == &quot;&quot; then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="ExistingSpecialGamesRoot" Type="LuaBlock" Var="
        if g_env.specialgamesroot ~= nil and g_env.specialgamesroot ~= &quot;&quot; then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckForMergeFiles" Type="FileExists" Var="[installerDir]/uninstall/GameHouse.rguninst"/>
    <ConditionDef Id="CheckForMergeFilesUpdated" Type="FileExists" Var="[installerDir]/cleaned"/>
    <ConditionDef Id="CheckForShortcuts" Type="FileExists" Var="[commonStartMenu]\Programs\GameHouse\Visit GameHouse.url"/>
    <ConditionDef Id="CheckForMortimerPremium" Type="LuaBlock" Var="
        local parm = 'amg-zumadeluxe'
        if parm == 'am-mortimerbeckettandthelostkingpremiumedition' then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckForJewelQuestPremium" Type="LuaBlock" Var="
        local parm = 'amg-zumadeluxe'
        if parm == 'am-jewelquestheritagepremiumedition' then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="PremiumContentFolder" Type="LuaBlock" Var="
        if g_env.PremiumContentFolder ~= nil and g_env.PremiumContentFolder ~= &quot;&quot; then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckValidGenreRGI" Type="LuaBlock" Var="
        local parm = 'Match 3 Games'
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckValidThumbnailRGI" Type="LuaBlock" Var="
        local parm = 'http://i.realone.com/assets/rn/img/4/5/9/6/10886954-6195567-thumbnail.jpg'
        if parm == &quot;&quot; or string.find( parm, '__BEGIN_TAG_') ~= nil then
            return false
        else
            return true
        end
    "/>
    <ConditionDef Id="CheckForGamesManager" Type="LuaBlock" Var="if luacom.CreateObject(&quot;RAComponents.RAGamesManager&quot;) then return true else return false end"/>
    <ConditionDef Id="CheckandRegisterGame" Type="LuaBlock" Var="
        dofile('MigrateDatabases.clf')
        CreateGameDatabaseMigrationObject().RegisterGame (&quot;amg-zumadeluxe&quot;, &quot;Zuma Deluxe&quot;, &quot;Match 3 Games&quot;)
        return true
    "/>

    <ConditionDef Id="CheckForCustomRGAForChannel" Type="LuaBlock" Var="
        local parm = 'yes'
        if parm == 'yes' then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckForCustomRGAForGame" Type="LuaBlock" Var="
        local parm = 'no'
        if parm == 'yes' then
            return true
        else
            return false
        end
    "/>
    <ConditionDef Id="CheckIsDipEnabled" Type="LuaBlock" Var="
        local parm = 'no'
        if parm == 'yes' then
            return true
        else
            return false
        end
    "/>
    
    <SetGlobalEnv Key="affiliate" Val="67616d65686f7573655f000000000000" >
        <ConditionCheck Id="CheckValidAffiliateRGI" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="tracking" Val="31383136000000000000000000000000" >
        <ConditionCheck Id="CheckValidTrackingRGI" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="currency" Val="555344000000" >
        <ConditionCheck Id="CheckValidCurrencyRGI" Val="true" />
        <ConditionCheck Id="CheckValidCurrencyRGILegacy" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="price" Val="" >
        <ConditionCheck Id="CheckValidPriceRGI" Val="true" />
    </SetGlobalEnv>
    <SetGlobalEnv Key="timestamp" Val="" >
        <ConditionCheck Id="CheckValidTimestampRGI" Val="true" />
    </SetGlobalEnv>

    <Payload Target="[installerDir]/uninstall/GameHouse.rguninst" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/gamehouse.txt" NoRemove="true">
        <ConditionCheck Id="CheckForMergeFilesUpdated" Val="false"/>
        <ConditionCheck Id="CheckForMergeFiles" Val="true"/>
        <Payload Target="[installerDir]/cleaned" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/gamehouse.txt" NoRemove="true"/>
    </Payload>
    <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\CurrentVersion" Subkey="" Val="2.0" NoRemove="true" />
    <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="ArcadeVersion" Val="2.5.0.58" NoRemove="true"/>
    <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="HtmlVersion" Val="2.6.0.306" NoRemove="true"/>
    <Payload Target="[tmpDir]\GameHouse\checkinst.rar" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/checkinst.rar" Persist="false" NoRemove="true">
        <ConditionCheck Id="CheckForStoreFront" Val="false" />
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="GameDesktopShortcuts" Val="off" NoRemove="true" NoOverwrite="true">
            <ConditionCheck Id="CanInitGameShortcuts" Val="nil" />
        </Regkey>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="GamesRoot" Val="[gamesRoot]" NoRemove="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="InstallDate" Val="[dateTime]" NoRemove="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="Tps" Val="gamehouse_" NoRemove="true" NoOverwrite="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="channel" Val="gamehouse_" NoRemove="true" NoOverwrite="true"/>
        <Regkey Id="GameDrop" Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="GameDesktopShortcuts" Val="on" NoRemove="true" >
            <ConditionCheck Id="CheckIfEULASlide" Val="true" />
        </Regkey>
    </Payload>
    <Payload Target="[tmpDir]\GameHouse\appresource\appresource.rar" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/resource/en/gamehouse_/appresource.rar" Persist="false" NoRemove="true" >
        <ConditionCheck Id="CheckForShortcuts" Val="false" />
        <Shortcut Link="[commonStartMenu]\Programs\GameHouse\Visit GameHouse.url" Target="http://www.gamehouse.com" Icon="[installerDir]\GameHouse\resource\gh.ico" NoRemove="true"/>
        <Shortcut Link="[desktop]\More Games at GameHouse.com.url" Target="http://www.gamehouse.com" Icon="[installerDir]\GameHouse\resource\gh.ico" NoRemove="true"/>
        <Bookmark Id="BookmarkDrop" Name="More Games at GameHouse.com" Url="http://www.gamehouse.com" NoRemove="true"></Bookmark>
    </Payload>
    
    <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="ChromeNumtries" Val="1" Inc="true">
        <ConditionCheck Id="GoogleTBStatusPing" Val="true"/>
        <ConditionCheck Id="ChromeStatusPing" Val="true"/>
        <ConditionCheck Id="OfferedChrome" Val="true"/>
    </Regkey>

    <SetEnv Id="InstallChrome" Key="IsInstallingChrome" Val="true" >
        <ConditionCheck Id="OfferedChrome" Val="true"/>
    </SetEnv >
    <SetEnv Id="InstallChrome2" Key="IsDefaultChrome" Val="true" >
        <ConditionCheck Id="OfferedChrome" Val="true"/>
    </SetEnv>
    <Payload Id="InstallChrome" Target="InstallChromeGH.rar" Src="http://games-dl2.real.com/gameconsole/realarcadev21/ThirdPartyOffer/v4-0-google/en/InstallChromeGH8-0.rar" Persist="false" DisplayProgress="true">
        <PostProcess Script="PostInstallChrome.lua"/>
        <ConditionCheck Id="IsSpecialGameForGoogleChrome" Val="false" />
        <ConditionCheck Id="OfferedChrome" Val="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="ChromeNumtries" Val="3"></Regkey>
        <Payload Target="InstallGamesPlayer.rar" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/plug-ins/gh/en/InstallGamesPlayer.rar" Persist="false" >
            <PostProcess Script="installgamesplayer.lua"/>
        </Payload>
        <SetEnv Key="IsInstallingChrome" Val="true" />
    </Payload>
    <Payload Id="InstallChrome" Target="InstallChromeGH.rar" Src="http://games-dl2.real.com/gameconsole/realarcadev21/ThirdPartyOffer/v4-0-google/en/InstallChromeGHSpecGame.rar" Persist="false" DisplayProgress="true">
        <PostProcess Script="PostInstallChrome.lua"/>
        <ConditionCheck Id="IsSpecialGameForGoogleChrome" Val="true" />
        <ConditionCheck Id="OfferedChrome" Val="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="ChromeNumtries" Val="3"></Regkey>
        <Payload Target="InstallGamesPlayer.rar" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/plug-ins/gh/en/InstallGamesPlayer.rar" Persist="false" >
            <PostProcess Script="installgamesplayer.lua"/>
        </Payload>
        <SetEnv Key="IsInstallingChrome" Val="true" />
    </Payload>


    <Payload Target="[installerDir]\commonResources\GameHouse\gamehouse_\custom.rga" Src="http://games-dl2.real.com/gameconsole/realarcadev21/custom/GameHouse/gamehouse_/custom.rga" Persist="true">
            <ConditionCheck Id="CheckForCustomRGAForChannel" Val="true"/>
    </Payload>

    <Payload Target="[gamesRoot]\Zuma Deluxe\amg-zumadeluxe.rga" Src="http://games-dl2.real.com/gameconsole/realarcadev21/games/amg-zumadeluxe/amg-zumadeluxe.rga" Persist="false" DisplayProgress="true">
        <SetGlobalEnv Key="myGameExe" Val="[gameExe]" />
        <SetGlobalEnv Key="myGamesRoot" Val="[gamesRoot]" />
        <SetGlobalEnv Key="myInstallDrive" Val="[installDrive]" />
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="affiliate" Type="BINARY" Val="[affiliate]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidAffiliate" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="affiliate" Type="BINARY" Val="[affiliate]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidAffiliateRGI" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="tracking" Type="BINARY" Val="[tracking]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidTracking" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="tracking" Type="BINARY" Val="[tracking]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidTrackingRGI" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="currency" Type="BINARY" Val="[currency]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidCurrency" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="currency" Type="BINARY" Val="[currency]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidCurrencyRGI" Val="true"/>
            <ConditionCheck Id="CheckValidCurrencyRGILegacy" Val="true" />
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="price" Type="BINARY" Val="[price]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidPrice" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="price" Type="BINARY" Val="[price]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidPriceRGI" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="timestamp" Type="BINARY" Val="[timestamp]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidTimestamp" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="timestamp" Type="BINARY" Val="[timestamp]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
            <ConditionCheck Id="CheckValidTimestampRGI" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="installation_time" Val="[dateTimeTM]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="path" Val="[gamesRoot]\Zuma Deluxe\[gameExe]" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_LOCAL_MACHINE\SOFTWARE\Trymedia Systems\ActiveMARK Software\[ContentID]" Subkey="gameid" Val="amg-zumadeluxe" >
            <ConditionCheck Id="CheckValidcontentid" Val="true"/>
        </Regkey>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="save" Val="false"/>
        <Regkey Id="GoogleDrop" Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="save" Val="true"/>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\2.0\Preferences" Subkey="CanOfferGoogle" Val="off" NoRemove="true">
            <ConditionCheck Id="CheckSaveStatus" Val="false"/>
        </Regkey>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\Games\amg-zumadeluxe\1" Subkey="InstallPath" Val="[gamesRoot]\Zuma Deluxe"></Regkey>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\Games\amg-zumadeluxe\1" Subkey="GameName" Val="amg-zumadeluxe"></Regkey>
        <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\Games\amg-zumadeluxe\1" Subkey="UninstallPath" Val="[installerDir]\uninstall\amg-zumadeluxe.rguninst"></Regkey>
        <Shortcut Id="GameDesktopShortcut" Link="[desktop]\Zuma Deluxe.lnk" Target="[gamesRoot]\Zuma Deluxe\[gameExe]" WorkDir="[gamesRoot]\Zuma Deluxe">
            <ConditionCheck Id="GamesShortcutsState" Val="on"/>
            <ConditionCheck Id="ExistingSpecialGamesRoot" Val="false"/>
        </Shortcut>
        <Shortcut Id="GameDesktopShortcut" Link="[desktop]\Super Jigsaw Puzzles.lnk" Target="[installDrive]\[programFolder]\[specialgamesroot]\[gameExe]" WorkDir="[installDrive]\[programFolder]\[specialgamesroot]" NoRemove="true">
            <ConditionCheck Id="GamesShortcutsState" Val="on"/>
            <ConditionCheck Id="ExistingSpecialGamesRoot" Val="true"/>
        </Shortcut>
        <Shortcut Link="[commonStartMenu]\Programs\GameHouse\Zuma Deluxe.lnk" Target="[gamesRoot]\Zuma Deluxe\[gameExe]" WorkDir="[gamesRoot]\Zuma Deluxe">
            <ConditionCheck Id="ExistingSpecialGamesRoot" Val="false"/>
        </Shortcut>
        <Shortcut Link="[commonStartMenu]\Programs\GameHouse\Super Jigsaw Puzzles.lnk" Target="[installDrive]\[programFolder]\[specialgamesroot]\[gameExe]" WorkDir="[installDrive]\[programFolder]\[specialgamesroot]" NoRemove="true">
            <ConditionCheck Id="ExistingSpecialGamesRoot" Val="true"/>
        </Shortcut>

        <Payload Target="[installDrive]\Program Files\RealArcade\Installer\amg-zumadeluxe-custom.rga" Src="http://games-dl2.real.com/gameconsole/realarcadev21/games/amg-zumadeluxe/amg-zumadeluxe-custom.rga" Persist="false">
            <ConditionCheck Id="CheckForCustomRGAForGame" Val="true"/>
        </Payload>

        <Payload Target="[gamesRoot]\Zuma Deluxe\amg-zumadeluxe_80x45.jpg" Src="http://i.realone.com/assets/rn/img/4/5/9/6/10886954-6195567-thumbnail.jpg" >
            <ConditionCheck Id="CheckForGamesManager" Val="true" />
            <ConditionCheck Id="CheckValidThumbnailRGI" Val="true"/>
            <Payload Target="MigrateDatabases.clf" Src="http://games-dl2.real.com/gameconsole/realarcadeclient/v2-6-0/common/MigrateDatabases.clf" NoRemove="true">
                <Regkey Key="HKEY_CLASSES_ROOT\SOFTWARE\GameHouse\Games\amg-zumadeluxe\1" Subkey="GamesManagerEnabled" Val="true" >
                    <ConditionCheck Id="CheckForGamesManager" Val="true" />
                    <ConditionCheck Id="CheckValidcontentid" Val="true"/>
                    <ConditionCheck Id="CheckValidGenreRGI" Val="true"/>
                    <ConditionCheck Id="CheckValidThumbnailRGI" Val="true"/>
                    <ConditionCheck Id="CheckandRegisterGame" Val="true" />
                </Regkey>
            </Payload>
        </Payload>
    </Payload>

    <Payload Id="GoogleToolbar" Target="GoogleTBGH.rar" Src="http://games-dl2.real.com/gameconsole/realarcadev21/ThirdPartyOffer/v4-0-google/en/GoogleTB6-6GH.rar" Persist="false" DisplayProgress="true">
        <PostProcess Script="googletb.lua"/>
        <ConditionCheck Id="OfferedGoogle" Val="true"/>
        <ConditionCheck Id="ShouldOfferGoogle" Val="true"/>
    </Payload>

    <Payload Id="KidStarter" Target="KidStarter.rar" Src="http://games-dl2.real.com/gameconsole/realarcadev21/ThirdPartyOffer/v4-0-google/en/kidstartersmall-12.rar" Persist="false" DisplayProgress="true">
        <PostProcess Script="installkidstarter.lua"/>
        <ConditionCheck Id="WasOfferedKidStarter" Val="true"/>
        <ConditionCheck Id="DetectDotNetv4" Val="true"/>
    </Payload>
    <Payload Id="KidStarter" Target="KidStarter.rar" Src="http://games-dl2.real.com/gameconsole/realarcadev21/ThirdPartyOffer/v4-0-google/en/kidstarterfull-12.rar" Persist="false" DisplayProgress="true">
        <PostProcess Script="installkidstarter.lua"/>
        <ConditionCheck Id="WasOfferedKidStarter" Val="true"/>
        <ConditionCheck Id="DetectDotNetv4" Val="false"/>
    </Payload>

    <DialogOptions CloseBtn="true" MinimizeBtn="true" Width="640" Height="480">
        <Chrome ImagePack="http://games-dl2.real.com/gameconsole/realarcadev21/chrome/GHChrome.rar"/>
        <OnBegin>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=eula&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" StepBucket="1">
                <ConditionCheck Id="CheckForClean" Val="nil"/>
                <OnNavigate>
                    <SetGlobalEnv Key="EULAPresented" Val="true" />
                </OnNavigate>
            </DialogUrl>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=eula&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" StepBucket="1">
                <ConditionCheck Id="CheckIfEULASlide" Val="false"/>
                <ConditionCheck Id="GamesRootWriteable" Val="NotWriteable"/>
                <OnNavigate>
                    <SetGlobalEnv Key="EULAPresented" Val="true" />
                </OnNavigate>
            </DialogUrl>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=kidstarterpromo&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" StepBucket="1">
                <ConditionCheck Id="IsKidStarterInstalled" Val="false" />
                <ConditionCheck Id="IsKidStarterCountry" Val="true"/>
                <ConditionCheck Id="IsKidStarterOS" Val="true" />
                <ConditionCheck Id="ShouldOfferKidStarter" Val="true" />
                <ConditionCheck Id="KidStarterOfferPing" Val="true"/>
                <OnNavigate>
                    <SetEnv Key="OfferedKidStarter" Val="true"/>
                </OnNavigate>
            </DialogUrl>
        </OnBegin>
        <DialogUrl Url="http://www.gamehouse.com/installer?sld=installingchrome&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="polling" StepBucket="1">
            <ConditionCheck Id="CheckIsInstallingChrome" Val="true" />
            <OnNavigate>
                <SetGlobalEnv Key="InstallComplete" Val="inprogress" />
                <SetEnv Key="ChromeReadyCanNext" Val="true" />
            </OnNavigate>
        </DialogUrl>
        <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcompletechrome&amp;launchchrome=false&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="polling" StepBucket="1">
            <ConditionCheck Id="CheckIsInstallingChrome" Val="true" />
            <ConditionCheck Id="CheckSpecialChromeLaunch" Val="ready" />
        </DialogUrl>      
        <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcompletechrome&amp;launchchrome=true&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="inf" StepBucket="1">
            <ConditionCheck Id="CheckIsInstallingChrome" Val="true" />
            <ConditionCheck Id="CheckSpecialChromeLaunch" Val="ready" />
            <ConditionCheck Id="ExecuteGoogleChrome" Val="true" />
            <OnNavigate>
                <SetEnv Key="SpecialChromeLaunch" Val="done" />
            </OnNavigate>
        </DialogUrl>
        <DialogUrl Url="http://www.gamehouse.com/installer?sld=installing&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="inf" StepBucket="1" >
            <ConditionCheck Id="OpenCandyAcceptedPing" Val="true"/>
            <ConditionCheck Id="InstallCandyOffer" Val="true"/>
            <OnNavigate>
                <SetGlobalEnv Key="InstallComplete" Val="inprogress" />
            </OnNavigate>
        </DialogUrl>
        <OnComplete>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcomplete2&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" >
                <ConditionCheck Id="CheckInstallComplete" Val="inprogress" />
                <ConditionCheck Id="CheckLaunchofWrapper" Val="false" />
                <OnNavigate>
                    <SetEnv Key="IsInstallingChrome" Val="false" />
                    <SetGlobalEnv Key="InstallComplete" Val="true" />
                </OnNavigate>
            </DialogUrl>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcomplete2&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" >
                <ConditionCheck Id="CheckInstallComplete" Val="inprogress" />              
                <ConditionCheck Id="CheckLaunchofWrapper" Val="false" />
                <OnNavigate>
                    <SetEnv Key="IsInstallingChrome" Val="false" />
                    <SetGlobalEnv Key="InstallComplete" Val="true" />
                </OnNavigate>
            </DialogUrl>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcomplete2&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="4" >
                <ConditionCheck Id="CheckInstallComplete" Val="true" />
                <ConditionCheck Id="IsSpecialGameForGoogleChrome" Val="true" />
                <ConditionCheck Id="ExecuteGoogleChromeWithLanding" Val="true" />
            </DialogUrl>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcomplete2&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="4" >
                <ConditionCheck Id="CheckInstallComplete" Val="true" />
                <ConditionCheck Id="IsSpecialGameForGoogleChrome" Val="false" />
                <ConditionCheck Id="ExecuteGoogleChrome" Val="true" />
            </DialogUrl>
            <PlaySound ResourceId="2000"/>
        </OnComplete>
        <OnException>
            <DialogUrl Url="http://www.gamehouse.com/installer?sld=installcancelled&amp;tps=gamehouse_&amp;gameid=amg-zumadeluxe" Duration="block" >
              <ConditionCheck Id="GoogleTBStatusPing" Val="true"/>
              <ConditionCheck Id="ChromeStatusPing" Val="true"/>
              <ConditionCheck Id="ExecuteGoogleChrome" Val="true" />
                <OnNavigate>
                    <SetEnv Key="IsInstallingChrome" Val="false" />
                </OnNavigate>
            </DialogUrl>
        </OnException>
    </DialogOptions>
</ArcadeInstaller>